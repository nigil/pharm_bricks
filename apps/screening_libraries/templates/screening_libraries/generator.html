{% extends 'pages/static_page.html' %}
{% load wagtailcore_tags %}
{% load thumbnail %}

{% block extra_content %}
<div class="container">
    <div class="row">
        <div class="card text-center tabl_no_mg" id="redactor_generation">
        </div>
    </div>
</div>


<div class="container">
    <div class="row">
        <div class="col-4">

        </div>
        <div class="col-6 tabl_no_mg">
            <p class="p_big">
                Select type of your Building Block
            </p>
        </div>
        <div class="col-2">

        </div>
    </div>
</div>


<div class="container">
    <div class="row">
        <div class="col-5"></div>
        <div class="col-7" id="generation_step_1_radios">
            {% for building_block in building_blocks %}
            <div class="p_small tabl tabl_gener_step">
                <input
                        type="radio"
                        id="{{ building_block.id }}"
                        name="radio_el"
                        value="{{ building_block.id }}"
                        class="posit_black posit checkbox"
                />
                <label for="{{ building_block.id }}" class="tab">{{ building_block.title }}</label>
                <br/>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<div class="container generation_step_1">
    <div class="row">
        <div class="col-12 text-center">
            <div class="butt_bott button_gener_step">
                <button class="generate disabled" id="generation_step_1_btn">generate</button>
            </div>
        </div>
    </div>
</div>

<div class="container generation_step_2">
    <div class="row">
        <div class="col-4">

        </div>
        <div class="col-6 tabl_no_mg">
            <p class="p_big">
                Select reagents
            </p>
        </div>
        <div class="col-2">

        </div>
    </div>
</div>
<div class="container generation_step_2">
    <div class="row">
        <div class="col-5">

        </div>
        <div class="col-7" id="generation_step_2_radios">
            {% for building_block in building_blocks %}
            <div class="generation_step_2_radios_{{ building_block.id }}">
                {% for reagent in building_block.reagents.all %}
                <div class="p_small tabl tabl_gener_step">
                    <input
                            type="checkbox"
                            name="step2_el"
                            id="{{ building_block.id }}_{{ reagent.file.id }}"
                            value="{{ reagent.id }}"
                            class="posit checkbox"/>
                    <label
                            for="{{ building_block.id }}_{{ reagent.file.id }}"
                            class="tab"
                    >{{ reagent.file.title }}</label>
                    <br/>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>
<div class="container generation_step_2_hide">
    <div class="row">
        <div class="col-12 text-center">
            <div class="butt_bott button_gener_step">
                <button class="generate disabled" id="generation_step_2_btn">generate</button>
            </div>
        </div>
    </div>
</div>

<div class="container generation_step_3">
    <div class="row text-center">
        <div class="col-12">
            <div>
                <button class="blue_butt button_gener_step button_gener_step_save" id="generation_step_3_btn">save to my libraries</button>
            </div>
            <div class="butt_bott">
                <a href="#" class="p_big a_green">
                    Download library_01.SDF
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block extra_js %}
{% csrf_token %}
<script type="text/javascript">
function jsmeOnLoad() {
    console.log('JSME onload');
    jsmeApplet = new JSApplet.JSME('redactor_generation');
    document.JME = jsmeApplet;
}

function get_checked_reagents() {
    var reagents_ids = [];
    $('input[name=step2_el]:checked').each(function(){
        reagents_ids.push($(this).val())
    });

    return reagents_ids;
}

$(function(){
    var csrf_token = $("[name=csrfmiddlewaretoken]").val();
    $('#generation_step_2_btn').click(function(){
        var editor_smiles = document.JME.smiles();
        var building_block_id = $('input[name=radio_el]:checked').val();
        var reagent_ids = get_checked_reagents();

        $.post(
            '/make_reaction/',
            {
                csrfmiddlewaretoken: csrf_token,
                editor_smiles: editor_smiles,
                building_block_id: building_block_id,
                reagent_ids: reagent_ids
            },
            function(data) {
                if (data.success) {
                    console.log('Reaction was success');
                }
                else {
                    console.log('Reaction was not success');
                }
            }
        );
    });
});
</script>
{% endblock %}